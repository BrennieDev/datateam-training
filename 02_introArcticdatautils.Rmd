#Using arcticdatautils

New data team members should complete exercises [two](#exercise2) and [three](#exercise3) as part of training.

## Uploading packages using R

We will be using the `arcticdatautils` package and the `dataone` package to connect to the [NSF Arctic Data Center (ADC)](https://arcticdata.io) data repository and push and pull edits. To identify yourself as an admin you will need to pass a 'token' into R. Do this by signing in to the ADC with your [ORCiD](https://orcid.org/register), hovering over your name and clicking on "My profile", then navigating to "Setings" and "Authentication Token", copying the "Token for DataONE R", and pasting and running it in your R console.

**This token is your identity on these sites, please treat it as you would a password** (ie. don't paste into scripts that will be shared). The easiest way to do this is to always run the token in the *console*. There's no need to keep it in your script since it's temporary anyway. Sometimes you'll see a placeholder in scripts to remind users to get their token, such as:

```{r token, message=FALSE, eval=FALSE}
options(dataone_test_token = "...")
```

Next, please be sure these packages are loaded:

```{r load libraries, message=FALSE}
library(devtools)
library(dataone)
library(remotes)
library(arcticdatautils)
```

Install any missing packages using `install.packages('PACKAGE_NAME')` in your R console. For `arcticdatautils`, you'll have to run `remotes::install_github("nceas/arcticdatautils")` because it's not on CRAN.

### Set environment

Once we have our libraries loaded, we need to tell R with which repo we want to work. If we are working on the production site, you can set the coordinating node (`cn`) and member node (`mn`) this way:

```{r set evnironment, eval= FALSE}
cn <- CNode('PROD')
mn <- getMNode(cn,'urn:node:ARCTIC')
```

If we are working in the test environment, we set it this way:

```{r, eval = FALSE}
cn <- CNode('STAGING')
mn <- getMNode(cn,'urn:node:mnTestARCTIC')
```

A note on nodes - be very careful about what you publish on the production node (PROD, or arcticdata.io). This node should NEVER be used to publish test or training datasets. While going through training exercises, you should be using the test environment (STAGING, or test.articdata.io). The CN is [DataONE](https://search.dataone.org/#data).

### What is in a package?

A data package generally consists of at least 3 "objects" or files:

- metadata
- data
- resource map

The **metadata** file is in XML format, and has the extension `.xml` (extensible markup language). We often refer to this file as the EML (Ecological Metadata Language), which is the metadata standard that it uses. 

Other objects are the **data** files themselves. Most commonly these are data tables (`.csv`), but they can also be audio files, netCDF files, plain text files, pdf documents, image files, etc. 

The final object is the **resource map**. This object is a text file that defines the relationships between all of the other objects in the data package. It says things like "this metadata file describes this data file," and is critical to making a data package render correctly on the website with the metadata file and all of the data files together in the correct place. Fortunately, we rarely, if ever, have to actually look at the contents of resource maps; they are generated for us using `arcticdatautils`.

Each of these objects are also associated with **system metadata**, which contains information such as file name, file type, and version. Don't worry too much about it now; we'll go into more detail in the later chapters.

![](images/resource-map.png)

### About identifiers

Each object (metadata files, data files, resource maps) on the ADC or KNB (another repo) has a unique identifier, also sometimes called a "PID" (persistent identifier). When you look at the landing page for a dataset, for example [here](https://arcticdata.io/catalog/#view/resource_map_doi:10.18739/A2836Z), you can find the resource map identifier in the URL (`resource_map_doi:10.18739/A2836Z`), the metadata identifer in the "General > Identifier" section of the metadata record (`doi:10.18739/A2836Z`), and the data identifier by clicking the "more info" link next to the data object, and looking at the "Online Distribution Info" section (`arctic-data.9546.1`).

Different versions of a package are linked together by what we call the "version chain" or "obsolescence chain". Making an update to a data package, such as replacing a data file, changing a metadata record, etc, will result in a new identifier for the new version of the updated object. 
