<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>NCEAS Data Team Training</title>
  <meta name="description" content="This is a training guide and reference resource for NCEAS interns working on the SASAP and Arctic Data Center Projects">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="NCEAS Data Team Training" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a training guide and reference resource for NCEAS interns working on the SASAP and Arctic Data Center Projects" />
  <meta name="github-repo" content="rstudio/datateam_training" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="NCEAS Data Team Training" />
  
  <meta name="twitter:description" content="This is a training guide and reference resource for NCEAS interns working on the SASAP and Arctic Data Center Projects" />
  

<meta name="author" content="Jeanette Clark">


<meta name="date" content="2017-12-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="using-arcticdatautils.html">
<link rel="next" href="editing-eml-in-r.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to NCEAS!</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#first-day-to-dos"><i class="fa fa-check"></i><b>1.1</b> First day to-dos</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#account-information"><i class="fa fa-check"></i><b>1.2</b> Account information</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#nceas-events"><i class="fa fa-check"></i><b>1.3</b> NCEAS Events</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html"><i class="fa fa-check"></i><b>2</b> Introduction to open science</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#open-science-background-reading"><i class="fa fa-check"></i><b>2.1</b> Open science background reading</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#effective-data-management"><i class="fa fa-check"></i><b>2.2</b> Effective data management</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#using-dataone"><i class="fa fa-check"></i><b>2.3</b> Using DataONE</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#working-on-a-remote-server"><i class="fa fa-check"></i><b>2.4</b> Working on a remote server</a><ul>
<li class="chapter" data-level="2.4.1" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#cyberduck-instructions"><i class="fa fa-check"></i><b>2.4.1</b> Cyberduck instructions</a></li>
<li class="chapter" data-level="2.4.2" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#a-note-on-paths"><i class="fa fa-check"></i><b>2.4.2</b> A note on paths</a></li>
<li class="chapter" data-level="2.4.3" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#exercise"><i class="fa fa-check"></i><b>2.4.3</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html"><i class="fa fa-check"></i><b>3</b> Using arcticdatautils</a><ul>
<li class="chapter" data-level="3.1" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#uploading-packages-using-r"><i class="fa fa-check"></i><b>3.1</b> Uploading packages using R</a><ul>
<li class="chapter" data-level="3.1.1" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#set-environment"><i class="fa fa-check"></i><b>3.1.1</b> Set environment</a></li>
<li class="chapter" data-level="3.1.2" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#set-token"><i class="fa fa-check"></i><b>3.1.2</b> Set token</a></li>
<li class="chapter" data-level="3.1.3" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#what-is-in-a-package"><i class="fa fa-check"></i><b>3.1.3</b> What is in a package?</a></li>
<li class="chapter" data-level="3.1.4" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#about-identifiers"><i class="fa fa-check"></i><b>3.1.4</b> About identifiers</a></li>
<li class="chapter" data-level="3.1.5" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#publishing-a-package-to-the-site"><i class="fa fa-check"></i><b>3.1.5</b> Publishing a package to the site</a></li>
<li class="chapter" data-level="3.1.6" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#exercise-1"><i class="fa fa-check"></i><b>3.1.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#uploading-a-new-version"><i class="fa fa-check"></i><b>3.2</b> Uploading a new version</a><ul>
<li class="chapter" data-level="3.2.1" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#exercise-2"><i class="fa fa-check"></i><b>3.2.1</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="system-metadata.html"><a href="system-metadata.html"><i class="fa fa-check"></i><b>4</b> System metadata</a><ul>
<li class="chapter" data-level="4.1" data-path="system-metadata.html"><a href="system-metadata.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="system-metadata.html"><a href="system-metadata.html#editing-sysmeta"><i class="fa fa-check"></i><b>4.2</b> Editing sysmeta</a><ul>
<li class="chapter" data-level="4.2.1" data-path="system-metadata.html"><a href="system-metadata.html#exercise-3"><i class="fa fa-check"></i><b>4.2.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="system-metadata.html"><a href="system-metadata.html#editing-sysmeta-on-lots-of-files"><i class="fa fa-check"></i><b>4.3</b> Editing sysmeta on lots of files</a></li>
<li class="chapter" data-level="4.4" data-path="system-metadata.html"><a href="system-metadata.html#identifiers-and-sysmeta"><i class="fa fa-check"></i><b>4.4</b> Identifiers and sysmeta</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html"><i class="fa fa-check"></i><b>5</b> Editing EML in R</a><ul>
<li class="chapter" data-level="5.1" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#making-edits"><i class="fa fa-check"></i><b>5.2</b> Making edits</a><ul>
<li class="chapter" data-level="5.2.1" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#setting-attributes"><i class="fa fa-check"></i><b>5.2.1</b> Setting attributes</a></li>
<li class="chapter" data-level="5.2.2" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#setting-other-entities"><i class="fa fa-check"></i><b>5.2.2</b> Setting other entities</a></li>
<li class="chapter" data-level="5.2.3" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#setting-coverages"><i class="fa fa-check"></i><b>5.2.3</b> Setting coverages</a></li>
<li class="chapter" data-level="5.2.4" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#setting-methods"><i class="fa fa-check"></i><b>5.2.4</b> Setting methods</a></li>
<li class="chapter" data-level="5.2.5" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#adding-people"><i class="fa fa-check"></i><b>5.2.5</b> Adding people</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#validating-and-writing-the-eml"><i class="fa fa-check"></i><b>5.3</b> Validating and writing the EML</a></li>
<li class="chapter" data-level="5.4" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#dealing-with-unusual-cases"><i class="fa fa-check"></i><b>5.4</b> Dealing with unusual cases</a></li>
<li class="chapter" data-level="5.5" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#exercise-4"><i class="fa fa-check"></i><b>5.5</b> Exercise</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">NCEAS Data Team Training</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="system-metadata" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> System metadata</h1>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">4.1</span> Introduction</h2>
<p>Every object in the Arctic Data Center (or on the KNB) has “system metadata.” An object’s system metadata has information about the file itself, such as the name of the file, the format, who the rights holder is, and what the access policy is (amongst other things). Sometimes we will need to edit system metadata in order to make sure that things on the webpage display correctly, or to ensure a file downloads from the website with the correct file name and extension.</p>
<p>Although the majority of system metadata changes that need to be made are done with the functions in arcticdatautils, sometimes we need to change aspects of the system metadata (or sysmeta) outside of those functions. This markdown explains how to do this using the functions <code>getSystemMetadata</code> and <code>updateSystemMetadata</code>.</p>
</div>
<div id="editing-sysmeta" class="section level2">
<h2><span class="header-section-number">4.2</span> Editing sysmeta</h2>
<p>First we need to load in some packages, and set up our environment. Note that typically if you are editing sysmeta you will need to set a token just like if you were updating a package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(arcticdatautils)
<span class="kw">library</span>(dataone)

cn &lt;-<span class="st"> </span><span class="kw">CNode</span>(<span class="st">&#39;STAGING&#39;</span>)
mn &lt;-<span class="st"> </span><span class="kw">getMNode</span>(cn,<span class="st">&#39;urn:node:mnTestARCTIC&#39;</span>) <span class="co">#Loading in the test environment for this example</span></code></pre></div>
<p>Next, we input the <code>mn</code> instance and PID of interest into the <code>getSystemMetadata</code> function. Note that the PID should be of the object of interest, not just the package of interest. Each individual object (metadata file, resource map, data file) will have its own system metadata.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pid &lt;-<span class="st"> &#39;urn:uuid:9a1b02a8-713e-4682-aafb-95c854a4c24a&#39;</span>
sysmeta &lt;-<span class="st"> </span><span class="kw">getSystemMetadata</span>(mn, pid)</code></pre></div>
<p>This returns an S4 object (more on these objects in Chapter 4), called <code>sysmeta</code>. The sysmeta object has the following “slots”: * serial version * identifier * formatId * checksum * checksumAlgorithm * submitter * rightsHolder * accesPolicy * replicationAllowed * numberReplicas * preferredNodes * blockedNodes * obsoletes * obsoletedBy * archived * dateUploaded * dateSysMetaModified.</p>
<p>You can view and edit slots using the <code>@</code> functionality.</p>
<p><code>sysmeta@fileName</code> <code>[1] &quot;WELTS_flatfile.csv&quot;</code></p>
<p>If you want to change a slot, you can simply do the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sysmeta@fileName &lt;-<span class="st"> &#39;AlaskaWells.csv&#39;</span></code></pre></div>
<p>Note that some slots cannot be changed by simple text replace (particularly the accessPolicy). There are various helper functions for changing the accessPolicy and rightsHolder such as <code>addAccessRule</code> (which takes the sysmeta as an input) or <code>set_access</code>, which only requires a PID. In general, you most frequently need to use <code>getSystemMetadata</code> to change either the formatId or fileName slots.</p>
<p>After you have changed the necessary slot, you can update the system metadata using the <code>updateSystemMetadata</code> function, which takes the <code>mn</code> instance, your PID of interest, and the edited sysmeta object as arguments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">updateSystemMetadata</span>(mn, pid, sysmeta)</code></pre></div>
<div id="exercise-3" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Exercise</h3>
<ul>
<li>Read the system metadata in from the data file you uploaded in the previous chapter</li>
<li>Check to make sure the <code>fileName</code> and <code>formatId</code> are set correctly</li>
<li>Update the system metadata if necessary.</li>
</ul>
</div>
</div>
<div id="editing-sysmeta-on-lots-of-files" class="section level2">
<h2><span class="header-section-number">4.3</span> Editing sysmeta on lots of files</h2>
<p>If you have a lot of files that all need a similar change, you can use a for loop or the apply functions to efficiently make all of your changes. Say you need to change all of the format IDs of data objects in a package so that they are <code>text/csv</code>. You could do this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PID &lt;-<span class="st"> &#39;some_pid&#39;</span>
ids &lt;-<span class="st"> </span><span class="kw">get_package</span>(mn, PID) <span class="co">#get all pids in a package</span>
data_pids &lt;-<span class="st"> </span><span class="kw">unlist</span>(ids$data)
for (i in <span class="dv">1</span>:<span class="kw">length</span>(data_pids)){    <span class="co">#run for loop over all of the data ids</span>
  sysmeta &lt;-<span class="st"> </span><span class="kw">getSystemMetadata</span>(mn, data_pids[i])
  sysmeta@formatId &lt;-<span class="st"> &quot;text/csv&quot;</span>
  <span class="kw">updateSystemMetadata</span>(mn, data_pids[i], sysmeta)
}</code></pre></div>
</div>
<div id="identifiers-and-sysmeta" class="section level2">
<h2><span class="header-section-number">4.4</span> Identifiers and sysmeta</h2>
<p>Importantly, changing the system metadata does NOT necessitate a change in the PID of an object. This is because changes to the system metadata do not change the object itself, they are only changing the description of the object (although ideally the system metadata is accurate when an object is first published).</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="using-arcticdatautils.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="editing-eml-in-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
