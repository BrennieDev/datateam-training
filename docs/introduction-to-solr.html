<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>NCEAS Data Team Training</title>
  <meta name="description" content="This is a training guide and reference resource for NCEAS data team members working on the SASAP and Arctic Data Center Projects">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="NCEAS Data Team Training" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a training guide and reference resource for NCEAS data team members working on the SASAP and Arctic Data Center Projects" />
  <meta name="github-repo" content="rstudio/datateam_training" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="NCEAS Data Team Training" />
  
  <meta name="twitter:description" content="This is a training guide and reference resource for NCEAS data team members working on the SASAP and Arctic Data Center Projects" />
  

<meta name="author" content="Jeanette Clark, Jesse Goldstein, Dominic Mullen, Bryce Mecum">


<meta name="date" content="2017-12-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="using-git-in-rstudio.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome to NCEAS!</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#first-day-to-dos"><i class="fa fa-check"></i><b>1.1</b> First day to-dos</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#account-information"><i class="fa fa-check"></i><b>1.2</b> Account information</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#nceas-events"><i class="fa fa-check"></i><b>1.3</b> NCEAS Events</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html"><i class="fa fa-check"></i><b>2</b> Introduction to open science</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#open-science-background-reading"><i class="fa fa-check"></i><b>2.1</b> Open science background reading</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#effective-data-management"><i class="fa fa-check"></i><b>2.2</b> Effective data management</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#using-dataone"><i class="fa fa-check"></i><b>2.3</b> Using DataONE</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#working-on-a-remote-server"><i class="fa fa-check"></i><b>2.4</b> Working on a remote server</a><ul>
<li class="chapter" data-level="2.4.1" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#cyberduck-instructions"><i class="fa fa-check"></i><b>2.4.1</b> Cyberduck instructions</a></li>
<li class="chapter" data-level="2.4.2" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#a-note-on-paths"><i class="fa fa-check"></i><b>2.4.2</b> A note on paths</a></li>
<li class="chapter" data-level="2.4.3" data-path="introduction-to-open-science.html"><a href="introduction-to-open-science.html#exercise1"><i class="fa fa-check"></i><b>2.4.3</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html"><i class="fa fa-check"></i><b>3</b> Using arcticdatautils</a><ul>
<li class="chapter" data-level="3.1" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#uploading-packages-using-r"><i class="fa fa-check"></i><b>3.1</b> Uploading packages using R</a><ul>
<li class="chapter" data-level="3.1.1" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#set-environment"><i class="fa fa-check"></i><b>3.1.1</b> Set environment</a></li>
<li class="chapter" data-level="3.1.2" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#set-token"><i class="fa fa-check"></i><b>3.1.2</b> Set token</a></li>
<li class="chapter" data-level="3.1.3" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#what-is-in-a-package"><i class="fa fa-check"></i><b>3.1.3</b> What is in a package?</a></li>
<li class="chapter" data-level="3.1.4" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#about-identifiers"><i class="fa fa-check"></i><b>3.1.4</b> About identifiers</a></li>
<li class="chapter" data-level="3.1.5" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#publishing-a-package-to-the-site"><i class="fa fa-check"></i><b>3.1.5</b> Publishing a package to the site</a></li>
<li class="chapter" data-level="3.1.6" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#exercise2"><i class="fa fa-check"></i><b>3.1.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#uploading-a-new-version"><i class="fa fa-check"></i><b>3.2</b> Uploading a new version</a><ul>
<li class="chapter" data-level="3.2.1" data-path="using-arcticdatautils.html"><a href="using-arcticdatautils.html#exercise3"><i class="fa fa-check"></i><b>3.2.1</b> Exercise</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="system-metadata.html"><a href="system-metadata.html"><i class="fa fa-check"></i><b>4</b> System metadata</a><ul>
<li class="chapter" data-level="4.1" data-path="system-metadata.html"><a href="system-metadata.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="system-metadata.html"><a href="system-metadata.html#editing-sysmeta"><i class="fa fa-check"></i><b>4.2</b> Editing sysmeta</a><ul>
<li class="chapter" data-level="4.2.1" data-path="system-metadata.html"><a href="system-metadata.html#exercise4"><i class="fa fa-check"></i><b>4.2.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="system-metadata.html"><a href="system-metadata.html#editing-sysmeta-on-lots-of-files"><i class="fa fa-check"></i><b>4.3</b> Editing sysmeta on lots of files</a></li>
<li class="chapter" data-level="4.4" data-path="system-metadata.html"><a href="system-metadata.html#identifiers-and-sysmeta"><i class="fa fa-check"></i><b>4.4</b> Identifiers and sysmeta</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html"><i class="fa fa-check"></i><b>5</b> Editing EML in R</a><ul>
<li class="chapter" data-level="5.1" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#making-edits"><i class="fa fa-check"></i><b>5.2</b> Making edits</a><ul>
<li class="chapter" data-level="5.2.1" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#setting-attributes"><i class="fa fa-check"></i><b>5.2.1</b> Setting attributes</a></li>
<li class="chapter" data-level="5.2.2" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#setting-other-entities"><i class="fa fa-check"></i><b>5.2.2</b> Setting other entities</a></li>
<li class="chapter" data-level="5.2.3" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#setting-coverages"><i class="fa fa-check"></i><b>5.2.3</b> Setting coverages</a></li>
<li class="chapter" data-level="5.2.4" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#setting-methods"><i class="fa fa-check"></i><b>5.2.4</b> Setting methods</a></li>
<li class="chapter" data-level="5.2.5" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#adding-people"><i class="fa fa-check"></i><b>5.2.5</b> Adding people</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#validating-and-writing-the-eml"><i class="fa fa-check"></i><b>5.3</b> Validating and writing the EML</a></li>
<li class="chapter" data-level="5.4" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#dealing-with-unusual-cases"><i class="fa fa-check"></i><b>5.4</b> Dealing with unusual cases</a></li>
<li class="chapter" data-level="5.5" data-path="editing-eml-in-r.html"><a href="editing-eml-in-r.html#exercise5"><i class="fa fa-check"></i><b>5.5</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="using-git-in-rstudio.html"><a href="using-git-in-rstudio.html"><i class="fa fa-check"></i><b>6</b> Using git in RStudio</a><ul>
<li class="chapter" data-level="6.1" data-path="using-git-in-rstudio.html"><a href="using-git-in-rstudio.html#introduction-2"><i class="fa fa-check"></i><b>6.1</b> Introduction</a><ul>
<li class="chapter" data-level="6.1.1" data-path="using-git-in-rstudio.html"><a href="using-git-in-rstudio.html#so-why-do-i-need-to-use-this-again"><i class="fa fa-check"></i><b>6.1.1</b> So why do I need to use this again?</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="using-git-in-rstudio.html"><a href="using-git-in-rstudio.html#setting-up-git"><i class="fa fa-check"></i><b>6.2</b> Setting up git</a><ul>
<li class="chapter" data-level="6.2.1" data-path="using-git-in-rstudio.html"><a href="using-git-in-rstudio.html#cloning-the-arctic-data-repo"><i class="fa fa-check"></i><b>6.2.1</b> Cloning the arctic-data repo</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="using-git-in-rstudio.html"><a href="using-git-in-rstudio.html#working-with-the-repository"><i class="fa fa-check"></i><b>6.3</b> Working with the repository</a><ul>
<li class="chapter" data-level="6.3.1" data-path="using-git-in-rstudio.html"><a href="using-git-in-rstudio.html#adding-a-new-script"><i class="fa fa-check"></i><b>6.3.1</b> Adding a new script</a></li>
<li class="chapter" data-level="6.3.2" data-path="using-git-in-rstudio.html"><a href="using-git-in-rstudio.html#editing-a-script"><i class="fa fa-check"></i><b>6.3.2</b> Editing a script</a></li>
<li class="chapter" data-level="6.3.3" data-path="using-git-in-rstudio.html"><a href="using-git-in-rstudio.html#where-do-i-commit"><i class="fa fa-check"></i><b>6.3.3</b> Where do I commit?</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="using-git-in-rstudio.html"><a href="using-git-in-rstudio.html#my-git-tab-disappeared"><i class="fa fa-check"></i><b>6.4</b> My Git tab disappeared</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="introduction-to-solr.html"><a href="introduction-to-solr.html"><i class="fa fa-check"></i><b>7</b> Introduction to Solr</a><ul>
<li class="chapter" data-level="7.1" data-path="introduction-to-solr.html"><a href="introduction-to-solr.html#querying-solr"><i class="fa fa-check"></i><b>7.1</b> Querying Solr</a><ul>
<li class="chapter" data-level="7.1.1" data-path="introduction-to-solr.html"><a href="introduction-to-solr.html#parts-of-a-query"><i class="fa fa-check"></i><b>7.1.1</b> Parts of a Query</a></li>
<li class="chapter" data-level="7.1.2" data-path="introduction-to-solr.html"><a href="introduction-to-solr.html#constructing-a-query"><i class="fa fa-check"></i><b>7.1.2</b> Constructing a Query</a></li>
<li class="chapter" data-level="7.1.3" data-path="introduction-to-solr.html"><a href="introduction-to-solr.html#faceting"><i class="fa fa-check"></i><b>7.1.3</b> Faceting</a></li>
<li class="chapter" data-level="7.1.4" data-path="introduction-to-solr.html"><a href="introduction-to-solr.html#stats"><i class="fa fa-check"></i><b>7.1.4</b> Stats</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="introduction-to-solr.html"><a href="introduction-to-solr.html#querying-solr-through-r"><i class="fa fa-check"></i><b>7.2</b> Querying Solr through R</a></li>
<li class="chapter" data-level="7.3" data-path="introduction-to-solr.html"><a href="introduction-to-solr.html#key-takeaways"><i class="fa fa-check"></i><b>7.3</b> Key takeaways</a></li>
<li class="chapter" data-level="7.4" data-path="introduction-to-solr.html"><a href="introduction-to-solr.html#more-resources"><i class="fa fa-check"></i><b>7.4</b> More resources</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">NCEAS Data Team Training</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="introduction-to-solr" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Introduction to Solr</h1>
<p>Solr is what’s known as an index. More specifically, it’s a piece of software that we install with every instance of Metacat which we use to query all of the Objects Metacat stores (metadata, data, resource maps, etc.). Every Object in Metacat will have a corresponding Solr document for it that contains information about that Object. Each type of Object will have a different set of fields in its Solr document. For example, an EML document will have a <code>title</code> field (corresponding to the EML document’s <code>&lt;title&gt;</code> element), while a CSV will not.</p>
<p>The fields that go into a Solr document are populated by information such as:</p>
<ul>
<li>The System Metadata (fileName, accessPolicy, etc)</li>
<li>The Object itself (e.g. title, creators, etc. for an EML record)</li>
<li>Additional computed fields (e.g., a geohash for quick spatial search)</li>
</ul>
<p>Indexing the Objects Metacat stores lets us execute some interesting and very useful queries such as:</p>
<ul>
<li>What are the most recently updated datasets?</li>
<li>What Metadata and Data Objects are in a given Data Package?</li>
<li>What is the total size (in terms of disk space) of all Objects stored in Metacat?</li>
</ul>
<div id="querying-solr" class="section level2">
<h2><span class="header-section-number">7.1</span> Querying Solr</h2>
<p>Solr is queried via what’s called an HTTP API. Practically, what this means it that you can visit a URL (web address) in a web browser to execute a query. This may be a little bit weird at first but I hope some examples will make it more clear.</p>
<p>So I said you visit a URL to query Solr. But what address do you visit? For the Arctic Data Center (<a href="https://arcticdata.io" class="uri">https://arcticdata.io</a>), every Solr query starts with a base URL of <a href="https://arcticdata.io/metacat/d1/mn/v2/query/solr/" class="uri">https://arcticdata.io/metacat/d1/mn/v2/query/solr/</a>. If you visit that URL, you will see a list of fields Solr is storing for the Objects it indexes:</p>
<div class="sourceCode"><pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;ns2:queryEngineDescription</span><span class="ot"> xmlns:ns2=</span><span class="st">&quot;http://ns.dataone.org/service/types/v1.1&quot;</span><span class="kw">&gt;</span>
  <span class="kw">&lt;queryEngineVersion&gt;</span>3.6.2.2012.12.18.19.52.59<span class="kw">&lt;/queryEngineVersion&gt;</span>
  <span class="kw">&lt;name&gt;</span>solr<span class="kw">&lt;/name&gt;</span>
  <span class="kw">&lt;queryField&gt;</span>
    <span class="kw">&lt;name&gt;</span>abstract<span class="kw">&lt;/name&gt;</span>
    <span class="kw">&lt;description&gt;</span>
      The full text of the abstract as provided in the science metadata document.
    <span class="kw">&lt;/description&gt;</span>
    ...truncated...</code></pre></div>
<p>You can see that there is a large set of queryable fields, though, as I said above, not all types of Objects will have values set for all of the possible fields because some fields do not make sense for some Objects (e.g., <code>title</code> for a CSV).</p>
<div id="parts-of-a-query" class="section level3">
<h3><span class="header-section-number">7.1.1</span> Parts of a Query</h3>
<p>Each Solr query is comprised of a number of parameters. These are like arguments to a function in R, but they are entered as parts of a URL.</p>
<p>The most common parameters are:</p>
<ul>
<li><code>q</code>: The query. This is like <code>subset</code> or <code>dplyr::filter</code> in R</li>
<li><code>fl</code>: What fields are returned for the documents that match your query (<code>q</code>). If not set, all fields are returned.</li>
<li><code>rows</code>: The maximum number of documents to return. Solr will truncate your result if the result size is greater than <code>rows</code>.</li>
<li><code>sort</code>: Sorts the result by the values in the given Solr field (e.g., sort by date uploaded)</li>
</ul>
<p>To use these parameters, we append to the base URL like this:</p>
<p><a href="https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q" class="uri">https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q</a>={QUERY}&amp;fl={FIELDS}&amp;rows={ROWS}</p>
<p>and we replace the text inside <code>{}</code> with the value we want for each parameter. Note that the parameters can come in any order so the following is equivalent:</p>
<p><a href="https://arcticdata.io/metacat/d1/mn/v2/query/solr/?fl" class="uri">https://arcticdata.io/metacat/d1/mn/v2/query/solr/?fl</a>={FIELDS}&amp;rows={ROWS}&amp;q={QUERY}</p>
<p>The first parameter in the URL must have a ‘?’ in front of it and all subsequent parameters must have an ‘&amp;’ between them. It’s really easy to get the URL wrong when typing it in manually like this so be sure to double-check your URL and think critically about the result: Solr tries to always return something even if it’s not what you intended.</p>
</div>
<div id="constructing-a-query" class="section level3">
<h3><span class="header-section-number">7.1.2</span> Constructing a Query</h3>
<p>The query (‘q’) parameter uses a syntax that looks like <code>field:value</code>, where <code>field</code> is one of the Solr fields and <code>value</code> is an expression. The expression can match a specific value exactly, e.g.,</p>
<ul>
<li><code>https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q=identifier:arctic-data.7747.1</code></li>
<li><code>https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q=identifier:&quot;doi:10.5065/D60P0X4S&quot;</code></li>
</ul>
<p>which finds the Solr document for a specific Object by PID (identifier). Note that in the second example, the DOI PID is surrounded in double quotes. This is because Solr has <a href="https://lucene.apache.org/core/2_9_4/queryparsersyntax.html">reserved characters</a>, of which ‘:’ is one, so we have to help Solr by surrounding values with reserved characters in them in quotes (as I did here) or escaping them.</p>
<p>Queries can take on a more advanced form such as a wildcard expression:</p>
<ul>
<li><code>https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q=identifier:arctic-data.*</code></li>
</ul>
<p>finds all the Objects that start with “arctic-data.” followed by anything (“*“)</p>
<ul>
<li><code>https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q=title:*soil*</code></li>
</ul>
<p>finds all the Objects with the word “soil” somewhere in the title.</p>
<ul>
<li><code>https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q=origin:*Stafford*+AND+title:Bering Strait&amp;fl=title&amp;sort=title+desc&amp;rows=10</code></li>
</ul>
<p>finds 10 Objects where one of the EML <code>creator</code>s has a name that contains the substring “Stafford” and the <code>title</code> contains the substring “Bering Strait”, sorted by <code>title</code> (descending order). Note that the <code>+AND+</code> between the <code>origin</code> and <code>title</code> query above specifies that both conditions must be true for a Solr document to be returned. We could’ve also switched the <code>+AND+</code> to <code>+OR+</code> and/or added more conditions to the query.</p>
<p>Here’s a slightly more advanced one:</p>
<ul>
<li><code>https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q=formatType:METADATA+AND+-obsoletedBy:*&amp;sort=dateUploaded+desc&amp;rows=25</code></li>
</ul>
<p>This query is the query MetacatUI uses to fill in the <a href="https://arcticdata.io/catalog/" class="uri">https://arcticdata.io/catalog/</a> page. Notice the <code>-obsoletedBy:*</code>. The ‘-’ before the field inverts the expression so this part of the query means “things that have no <code>obsoletedBy</code> value set”.</p>
<p>We can also just find everything:</p>
<ul>
<li><code>https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q=*:*</code></li>
</ul>
<p>finds any value in any field.</p>
</div>
<div id="faceting" class="section level3">
<h3><span class="header-section-number">7.1.3</span> Faceting</h3>
<p>Above we went through querying across Solr documents but we can also summarize what’s in Solr with Faceting which lets us group Solr documents together and count them. This is like <code>table</code> in R. Faceting can do a query within a query, but more commonly I use it to summarize unique values in a field. For example, we can find the unique format IDs on Data Objects:</p>
<ul>
<li><a href="https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q=*:*&amp;fq=formatType:DATA&amp;facet=true&amp;facet.field=formatId&amp;rows=0" class="uri">https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q=*:*&amp;fq=formatType:DATA&amp;facet=true&amp;facet.field=formatId&amp;rows=0</a></li>
</ul>
<p>To facet, we usually do a few things:</p>
<ul>
<li>Add the parameter <code>facet=true</code></li>
<li>Add the parameter <code>facet.field={FIELD}</code> with the field we want to facet (group) on</li>
<li>Set <code>rows=0</code> because we don’t care about the matched Solr documents</li>
<li>Optionally specify <code>fq={expression}</code> which filters out Solr documents before faceting. In the above example, we have to do this to only count Data Objects. Without it, the facet result would include formatIDs for metadata and resource maps which we don’t want.</li>
</ul>
</div>
<div id="stats" class="section level3">
<h3><span class="header-section-number">7.1.4</span> Stats</h3>
<p>With Faceting, we found we could make queries to find the unique values for a Solr field. With Stats, we can have Solr calculate statistics on numerical values (such as <code>fileSize</code>).</p>
<ul>
<li><a href="https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q=formatType:DATA&amp;stats=true&amp;stats.field=size&amp;rows=0" class="uri">https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q=formatType:DATA&amp;stats=true&amp;stats.field=size&amp;rows=0</a></li>
</ul>
<p>This query calculates a set of summary statistics for the <code>size</code> field on Data Objects that Solr has indexed. In this case, Solr’s <code>size</code> field indexes the <code>fileSize</code> field in the System Metadata for each Object in Metacat.</p>
</div>
</div>
<div id="querying-solr-through-r" class="section level2">
<h2><span class="header-section-number">7.2</span> Querying Solr through R</h2>
<p>What if I told you that every time you run the <code>query</code> function in the <code>dataone</code> R package you are asking R to visit a URL like the ones above, parse the information returned by the page, and present it in an R-friendly way such as a <code>list</code> or <code>data.frame</code>? Well that’s what happens! Then why might we use R in the first place? There are two big advantages:</p>
<ol style="list-style-type: decimal">
<li>The result is returned in a more useful way to R without extra work on your part</li>
<li>We can more easily pass our authentication token with the query</li>
</ol>
<p>Why does #2 matter? Well by default, all of those URLs above only returned publicly-readable Solr documents. If a private document matched any of those queries, Solr doesn’t give you any idea and acts like the non-public-readable documents don’t exist. So we must pass an authentication token to access non-public-readable content. This bit is crucial for working with the Arctic Data Center so you’ll very often want to use R instead of visiting those URLs in a web browser.</p>
<p>And there’s good news: all of the URLs you visited above can be turned into an R expression very easily. For example:</p>
<ul>
<li><code>https://arcticdata.io/metacat/d1/mn/v2/query/solr/?q=title:*soil*</code></li>
</ul>
<p>becomes</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dataone)
cn &lt;-<span class="st"> </span><span class="kw">CNode</span>(<span class="st">&quot;PROD&quot;</span>)
mn &lt;-<span class="st"> </span><span class="kw">getMNode</span>(cn, <span class="st">&quot;urn:node:ARCTIC&quot;</span>)
<span class="co"># Set your token if you need/want!</span>
<span class="kw">query</span>(mn, <span class="st">&quot;q=title:*soil*&amp;fl=title&amp;rows=10&quot;</span>)</code></pre></div>
<p>I just deleted the first part of the URL, up to and including the ‘?’, and pasted the rest in as the second argument to <code>query</code>. You may have seen an alternative syntax:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">query</span>(mn, <span class="kw">list</span>(<span class="dt">q=</span><span class="st">&quot;title:*soil*&quot;</span>,
               <span class="dt">fl=</span><span class="st">&quot;title&quot;</span>,
               <span class="dt">rows=</span><span class="st">&quot;10&quot;</span>))</code></pre></div>
<p>this is the same query as above because the <code>query</code> function takes either a string (the first form) or a named list (the second form).</p>
<p>By default, <code>query</code> returns the result as a <code>list</code>. This is definitely useful but a <code>data.frame</code> can be a more useful way to work with the result. To get a <code>data.frame</code> instead, just set the <code>as</code> argument to ‘data.frame’ to get a <code>data.frame</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">query</span>(mn, <span class="kw">list</span>(<span class="dt">q=</span><span class="st">&quot;title:*soil*&quot;</span>,
               <span class="dt">fl=</span><span class="st">&quot;title&quot;</span>,
               <span class="dt">rows=</span><span class="st">&quot;10&quot;</span>),
      <span class="dt">as =</span> <span class="st">&quot;data.frame&quot;</span>)
<span class="dv">1</span>  Daily Average Soil, Air and Ground Temperatures -<span class="st"> </span>Council Forest Site [Romanovsky, V.]
<span class="dv">2</span>     Canadian Transect of Soils and Vegetation for the Circumpolar Arctic Vegetation Map
<span class="dv">3</span>                                   Soil Temperatures, Toolik Lake, Alaska, <span class="dv">1995</span> and <span class="dv">1996</span>
<span class="dv">4</span>                                        Soil Temperature ARCSS grid Atqasuk, Alaska <span class="dv">2013</span>
<span class="dv">5</span>                                                        X-ray fluorescence, Barrow soils
<span class="dv">6</span>                                                Toolik Lake, Alaska Soil moisture -<span class="st"> </span><span class="dv">2014</span>
<span class="dv">7</span>                           Thermal Soil Properties for Ivotuk and Council [Beringer, J.]
<span class="dv">8</span>                                          Soil Temperature NIMS grid Barrow, Alaska <span class="dv">2014</span>
<span class="dv">9</span>                                           Ivotuk Soil Data -<span class="st"> </span>Station Met2 [Hinzman, L.]
<span class="dv">10</span>                                                         thule_tram_soil_temps_2013.csv</code></pre></div>
</div>
<div id="key-takeaways" class="section level2">
<h2><span class="header-section-number">7.3</span> Key takeaways</h2>
<ul>
<li>Find out what you can query at <a href="https://arcticdata.io/metacat/d1/mn/v2/query/solr" class="uri">https://arcticdata.io/metacat/d1/mn/v2/query/solr</a></li>
<li>The Solr HTTP API is what the R <code>dataone</code> package uses when you run <code>query</code></li>
<li>Pass a token if you want to include non-public-readable objects in the results (you often do!)</li>
</ul>
</div>
<div id="more-resources" class="section level2">
<h2><span class="header-section-number">7.4</span> More resources</h2>
<ul>
<li>Solr’s <a href="https://cwiki.apache.org/confluence/display/solr/The+Standard+Query+Parser">The Standard Query Parser</a> docs (high level of detail)</li>
<li>Another quick reference: <a href="https://wiki.apache.org/solr/SolrQuerySyntax" class="uri">https://wiki.apache.org/solr/SolrQuerySyntax</a></li>
<li><a href="http://www.solrtutorial.com/" class="uri">http://www.solrtutorial.com/</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="using-git-in-rstudio.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
