<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>NCEAS Intern Training</title>
  <meta name="description" content="This is a training guide and reference resource for NCEAS interns working on the SASAP and Arctic Data Center Projects">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="NCEAS Intern Training" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a training guide and reference resource for NCEAS interns working on the SASAP and Arctic Data Center Projects" />
  <meta name="github-repo" content="rstudio/intern_training" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="NCEAS Intern Training" />
  
  <meta name="twitter:description" content="This is a training guide and reference resource for NCEAS interns working on the SASAP and Arctic Data Center Projects" />
  

<meta name="author" content="Jeanette Clark">


<meta name="date" content="2017-12-13">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="validating-and-writing-the-eml.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Placeholder</a></li>
<li class="chapter" data-level="2" data-path="placeholder-1.html"><a href="placeholder-1.html"><i class="fa fa-check"></i><b>2</b> Placeholder</a></li>
<li class="chapter" data-level="3" data-path="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html"><a href="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html"><i class="fa fa-check"></i><b>3</b> devtools::install_github(“NCEAS/arcticdatautils”, ref = “v0.5.0”)</a><ul>
<li class="chapter" data-level="3.1" data-path="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html"><a href="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html#editing-packages-in-r"><i class="fa fa-check"></i><b>3.1</b> Editing packages in R</a><ul>
<li class="chapter" data-level="3.1.1" data-path="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html"><a href="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html#set-environment"><i class="fa fa-check"></i><b>3.1.1</b> Set environment</a></li>
<li class="chapter" data-level="3.1.2" data-path="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html"><a href="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html#set-token"><i class="fa fa-check"></i><b>3.1.2</b> Set token</a></li>
<li class="chapter" data-level="3.1.3" data-path="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html"><a href="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html#publishing-a-package-to-the-site"><i class="fa fa-check"></i><b>3.1.3</b> Publishing a package to the site</a></li>
<li class="chapter" data-level="3.1.4" data-path="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html"><a href="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html#edit-material"><i class="fa fa-check"></i><b>3.1.4</b> Edit material</a></li>
<li class="chapter" data-level="3.1.5" data-path="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html"><a href="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html#update-the-data-package-with-the-new-eml-and-file"><i class="fa fa-check"></i><b>3.1.5</b> Update the data package with the new EML and file</a></li>
<li class="chapter" data-level="3.1.6" data-path="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html"><a href="devtoolsinstall-githubnceasarcticdatautils-ref-v0-5-0.html#update-metadata-with-the-otherentities-added"><i class="fa fa-check"></i><b>3.1.6</b> update metadata with the otherEntities added</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>4</b> Introduction</a></li>
<li class="chapter" data-level="5" data-path="attributes.html"><a href="attributes.html"><i class="fa fa-check"></i><b>5</b> Attributes</a><ul>
<li class="chapter" data-level="5.1" data-path="attributes.html"><a href="attributes.html#building-the-attribute-table"><i class="fa fa-check"></i><b>5.1</b> Building the attribute table</a></li>
<li class="chapter" data-level="5.2" data-path="attributes.html"><a href="attributes.html#defining-enumerated-domains"><i class="fa fa-check"></i><b>5.2</b> Defining enumerated domains</a></li>
<li class="chapter" data-level="5.3" data-path="attributes.html"><a href="attributes.html#generating-the-attribute-list-and-data-table"><i class="fa fa-check"></i><b>5.3</b> Generating the attribute list and data table</a></li>
<li class="chapter" data-level="5.4" data-path="attributes.html"><a href="attributes.html#adding-a-second-datatable"><i class="fa fa-check"></i><b>5.4</b> Adding a second dataTable</a></li>
<li class="chapter" data-level="5.5" data-path="attributes.html"><a href="attributes.html#defining-custom-units"><i class="fa fa-check"></i><b>5.5</b> Defining custom units</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="setting-other-entities.html"><a href="setting-other-entities.html"><i class="fa fa-check"></i><b>6</b> Setting other entities</a><ul>
<li class="chapter" data-level="6.1" data-path="setting-other-entities.html"><a href="setting-other-entities.html#for-files-that-arent-uploaded-yet"><i class="fa fa-check"></i><b>6.1</b> For files that aren’t uploaded yet</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="for-files-that-are-already-uploaded.html"><a href="for-files-that-are-already-uploaded.html"><i class="fa fa-check"></i><b>7</b> For files that are already uploaded</a></li>
<li class="chapter" data-level="8" data-path="coverage.html"><a href="coverage.html"><i class="fa fa-check"></i><b>8</b> Coverage</a></li>
<li class="chapter" data-level="9" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>9</b> Methods</a></li>
<li class="chapter" data-level="10" data-path="keywords.html"><a href="keywords.html"><i class="fa fa-check"></i><b>10</b> Keywords</a></li>
<li class="chapter" data-level="11" data-path="people.html"><a href="people.html"><i class="fa fa-check"></i><b>11</b> People</a></li>
<li class="chapter" data-level="12" data-path="validating-and-writing-the-eml.html"><a href="validating-and-writing-the-eml.html"><i class="fa fa-check"></i><b>12</b> Validating and Writing the EML</a></li>
<li class="chapter" data-level="13" data-path="dealing-with-unusual-cases.html"><a href="dealing-with-unusual-cases.html"><i class="fa fa-check"></i><b>13</b> Dealing with unusual cases</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">NCEAS Intern Training</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dealing-with-unusual-cases" class="section level1">
<h1><span class="header-section-number">Chapter 13</span> Dealing with unusual cases</h1>
<p>Typically, the biggest issue most datateam members have using the EML package is trying to add multiple values within a slot. In some cases, like adding multiple <code>dataTable</code> instances or multiple <code>creator</code> instances, this is easy, as is shown above. Other times, particularly if the slot is nested within a slot that we use a helper function for (like <code>set_attributes</code>), it can get a little more challenging. By delving a little deeper into the EML S4 class of objects though, you can resolve most problems relatively easily.</p>
<p>Any slot that allows for a list of objects, as listed in the EML schema (<a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/index.html" class="uri">https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/index.html</a>), will have a class called the slot name, in addition to a class called <code>ListOfslotName</code>. You can use the <code>new</code> function to create an object of the slot itself and a list of objects within that slot. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m1 &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&#39;missingValueCode&#39;</span>, <span class="dt">code =</span> <span class="st">&#39;NA&#39;</span>, <span class="dt">codeExplanation =</span> <span class="st">&#39;No data taken&#39;</span>)
m2 &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&#39;missingValueCode&#39;</span>, <span class="dt">code =</span> <span class="st">&#39;-999&#39;</span>,  <span class="dt">codeExplanation =</span> <span class="st">&#39;Sensor malfunctioned&#39;</span>)

codes &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&#39;ListOfmissingValueCode&#39;</span>, <span class="kw">list</span>(m1, m2))</code></pre></div>
<p>In this case, this slot is nested within a part of the EML that we typically construct with a helper function - so how do we actually get this list of missing value codes into the attribute table?</p>
<p>One strategy would be to construct the attribute list without the missing value code information for the attribute with mutliple attributes, and then insert the <code>ListOfmissingValueCode</code> into it. So, building our attribute list as normal,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">attributes1 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;~/arctic-data/docs/training/EML/LakeSampleData.csv&#39;</span>, <span class="dt">stringsAsFactors =</span> F)
attlist1 &lt;-<span class="st"> </span><span class="kw">set_attributes</span>(attrbutes1)</code></pre></div>
<p>You can then dig down into the individual attributes using the <code>@</code> functionality. Note that all of the attributes are stored as a <code>ListOfattributes</code> object. You can view a single value within this list by calling <code>attlist1@attributes@.Data[[n]]</code> where n represents the index of the list you want to view.</p>
<pre><code>attlist1@attribute@.Data[[1]]
&lt;attribute system=&quot;uuid&quot;&gt;
  &lt;attributeName&gt;Date&lt;/attributeName&gt;
  &lt;attributeDefinition&gt;Date sample was taken on&lt;/attributeDefinition&gt;
  &lt;measurementScale&gt;
    &lt;dateTime&gt;
      &lt;formatString&gt;MM-DD-YYYY&lt;/formatString&gt;
    &lt;/dateTime&gt;
  &lt;/measurementScale&gt;
&lt;/attribute&gt;</code></pre>
<p>You can also run commands on <code>attlist1@attribute@.Data</code> just like you would any other list. One useful one is <code>length(attlist1@attribute@.Data)</code> which will return the number of items in the list.</p>
<p>So to insert the list of missing value codes, you’ll need to navigate to the index in the list of the attribute that you need to modify, and then dig even deeper into the slots. Don’t forget that the <code>tab</code> key is your friend and can help you find slot names! So if you know that you need to change the 6th attribute in the list, you can type the following to see what is in there now:</p>
<pre><code>attlist1@attribute@.Data[[6]]@missingValueCode

An object of class &quot;ListOfmissingValueCode&quot;
[[1]]
&lt;missingValueCode/&gt;</code></pre>
<p>Now to add the list, you’ll have to execute the following (repeating lines for clarity):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m1 &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&#39;missingValueCode&#39;</span>, <span class="dt">code =</span> <span class="st">&#39;NA&#39;</span>, <span class="dt">codeExplanation =</span> <span class="st">&#39;No data taken&#39;</span>)
m2 &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&#39;missingValueCode&#39;</span>, <span class="dt">code =</span> <span class="st">&#39;-999&#39;</span>,  <span class="dt">codeExplanation =</span> <span class="st">&#39;Sensor malfunctioned&#39;</span>)

codes &lt;-<span class="st"> </span><span class="kw">new</span>(<span class="st">&#39;ListOfmissingValueCode&#39;</span>, <span class="kw">list</span>(m1, m2))

attlist1@attribute@.Data[[<span class="dv">6</span>]]@missingValueCode &lt;-<span class="st"> </span>codes</code></pre></div>
<p>Now, if you view this attribute again you should see the mutliple missing value codes:</p>
<pre><code>&gt; attlist1@attribute@.Data[[6]]@missingValueCode
An object of class &quot;ListOfmissingValueCode&quot;
[[1]]
&lt;missingValueCode&gt;
  &lt;code&gt;NA&lt;/code&gt;
  &lt;codeExplanation&gt;No data taken&lt;/codeExplanation&gt;
&lt;/missingValueCode&gt;

[[2]]
&lt;missingValueCode&gt;
  &lt;code&gt;-999&lt;/code&gt;
  &lt;codeExplanation&gt;Sensor malfunctioned&lt;/codeExplanation&gt;
&lt;/missingValueCode&gt;</code></pre>
<p>What I showed above is a pretty specific example (which conveniently is also one of our more common “rare cases”), but there are some general strategies you can employ to figure out how to insert other objects that need to be deeply nested into an EML.</p>
<ul>
<li><strong>Create an empty test object</strong>: example: <code>test &lt;- new('abstract')</code></li>
<li><strong>Use the @ and <code>tab</code> functionality to explore slots in that object</strong>: example: <code>test@para</code></li>
<li><em>What are all these slots??</em>: Remember that the <code>schemaLocation</code>, <code>lang</code>, <code>slot_order</code>, and <code>section</code> slots are related to the schema and are not actual slots which contain values you can edit.</li>
<li><em><code>.Data</code></em>: if you run into a <code>.Data</code> using the <code>tab</code> key, that means that the slot can be part of a list.</li>
<li><strong>Use indexing to access individual items in a list</strong>: example: <code>test@para@.Data[[2]]</code></li>
<li><em>Index out of bounds</em>: If you receive an “index out of bounds” error that means you are trying to access an index beyond what exists in the list. For example, if there are 4 paragraphs in the abstract, and you write <code>test@para@.Data[[5]]</code> you will recieve this error.</li>
<li><strong>Use the schema!</strong>: <a href="https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/index.html" class="uri">https://knb.ecoinformatics.org/#external//emlparser/docs/eml-2.1.1/index.html</a></li>
</ul>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="validating-and-writing-the-eml.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
